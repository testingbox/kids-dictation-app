<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å°æœ‹å‹é»˜ç”Ÿå­—</title>
<style>
  body { font-family: sans-serif; padding: 20px; text-align: center; background: #f0f8ff; }
  h2 { font-size: 24px; margin-bottom: 15px; }
  textarea { width: 100%; max-width: 400px; height: 180px; font-size: 18px; padding: 10px; border-radius: 10px; border: 1px solid #ccc; }
  button { 
    display: block; 
    width: 90%; 
    max-width: 300px;
    margin: 10px auto; 
    padding: 15px; 
    font-size: 20px; 
    border: none; 
    border-radius: 12px;
    background: #4CAF50; 
    color: white; 
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: background 0.2s, transform 0.1s;
  }
  button:hover { background: #45a049; }
  button:active { background: #3e8e41; transform: scale(0.95); }
  #wordDisplay { font-size: 32px; margin-top: 20px; color: #333; min-height: 40px; transition: opacity 0.5s; }
  #counterDisplay { font-size: 20px; margin-top: 10px; color: #555; }
  .hidden { display: none; }
</style>
</head>
<body>

<!-- ç¬¬ä¸€ç‰ˆï¼šè¼¸å…¥ç”Ÿå­— -->
<div id="inputPage">
  <h2>è¼¸å…¥ç”Ÿå­—ï¼ˆæ¯è¡Œä¸€å€‹ï¼‰</h2>
  <textarea id="wordInput" placeholder="ä¾‹å¦‚ï¼š\nè˜‹æœ\né¦™è•‰\næ©™å­"></textarea><br>
  <button onclick="confirmWords()">âœ… ç¢ºèª</button>
</div>

<!-- ç¬¬äºŒç‰ˆï¼šæ“ä½œç‰ˆ -->
<div id="gamePage" class="hidden">
  <h2>æŠ½ç”Ÿå­—æœ—è®€</h2>
  <div id="counterDisplay">å°šæœªé–‹å§‹</div>
  <div id="wordDisplay">(è«‹å…ˆæŠ½å‡ºä¸€å€‹ç”Ÿå­—)</div>
  <div>
    <button onclick="drawWord()">ğŸ² æŠ½å‡ºç”Ÿå­—ä¸¦æœ—è®€</button>
    <button onclick="showWord()">ğŸ‘ï¸â€ğŸ—¨ï¸ é¡¯ç¤ºå‰›æ‰ç”Ÿå­—</button>
    <button onclick="replayWord()">ğŸ”Š é‡è®€ä¸€æ¬¡</button>
    <button onclick="backToInput()">ğŸ”™ è¿”å›è¼¸å…¥é </button>
  </div>
</div>

<!-- å®Œæˆé é¢ -->
<div id="completePage" class="hidden">
  <h2>ğŸ‰ æ­å–œï¼ä½ å·²å®Œæˆå…¨éƒ¨ç”Ÿå­—é»˜æ›¸ï¼</h2>
  <button onclick="backToInput()">ğŸ”„ å†ä¾†ä¸€æ¬¡</button>
</div>

<script>
let words = [];
let currentWord = "";
let voices = [];
let selectedVoice = null;
let counter = 0;

function initVoices() {
  voices = speechSynthesis.getVoices();
  selectedVoice = voices.find(voice => voice.lang.includes('zh-HK') || voice.name.includes('Cantonese')) ||
                  voices.find(voice => voice.lang.includes('zh-CN')) ||
                  voices.find(voice => voice.lang.includes('en-US'));
}

if (speechSynthesis.onvoiceschanged !== undefined) {
  speechSynthesis.onvoiceschanged = initVoices;
}

window.onload = function() {
  setTimeout(initVoices, 500);
};

function confirmWords() {
  const input = document.getElementById('wordInput').value.trim();
  words = input.split('\n').map(word => word.trim()).filter(word => word);
  if (words.length === 0) {
    alert('è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹ç”Ÿå­—ï¼');
    return;
  }
  document.getElementById('inputPage').classList.add('hidden');
  document.getElementById('gamePage').classList.remove('hidden');
  counter = 0;
  updateCounterDisplay();
  document.getElementById('wordDisplay').textContent = "(è«‹å…ˆæŠ½å‡ºä¸€å€‹ç”Ÿå­—)";
}

function drawWord() {
  if (words.length === 0) {
    alert('ç”Ÿå­—æ¸…å–®æ˜¯ç©ºçš„ï¼Œè«‹é‡æ–°è¼¸å…¥ç”Ÿå­—ï¼');
    return;
  }
  counter++;
  updateCounterDisplay();
  const index = Math.floor(Math.random() * words.length);
  currentWord = words.splice(index, 1)[0];
  fadeOutInWordDisplay();
  speak("ç¬¬" + counter + "å€‹ç”Ÿå­—ï¼Œ" + currentWord);
  if (words.length === 0) {
    setTimeout(() => {
      document.getElementById('gamePage').classList.add('hidden');
      document.getElementById('completePage').classList.remove('hidden');
    }, 800);
  }
}

function showWord() {
  if (!currentWord) {
    alert('è«‹å…ˆæŠ½å‡ºä¸€å€‹ç”Ÿå­—ï¼');
    return;
  }
  document.getElementById('wordDisplay').textContent = currentWord;
}

function replayWord() {
  if (!currentWord) {
    alert('è«‹å…ˆæŠ½å‡ºä¸€å€‹ç”Ÿå­—ï¼');
    return;
  }
  speak(currentWord);
}

function backToInput() {
  counter = 0;
  currentWord = "";
  document.getElementById('counterDisplay').textContent = "å°šæœªé–‹å§‹";
  document.getElementById('wordDisplay').textContent = "(è«‹å…ˆæŠ½å‡ºä¸€å€‹ç”Ÿå­—)";
  document.getElementById('gamePage').classList.add('hidden');
  document.getElementById('completePage').classList.add('hidden');
  document.getElementById('inputPage').classList.remove('hidden');
}

function updateCounterDisplay() {
  document.getElementById('counterDisplay').textContent = "å·²é»˜ç¬¬ " + counter + " å€‹ç”Ÿå­—";
}

function speak(text) {
  if (!text) return;

  const utterance = new SpeechSynthesisUtterance(text);

  if (!selectedVoice || voices.length === 0) {
    initVoices();
  }

  if (selectedVoice) {
    utterance.voice = selectedVoice;
  }

  utterance.rate = 0.9;
  speechSynthesis.speak(utterance);
}

function fadeOutInWordDisplay() {
  const wordDisplay = document.getElementById('wordDisplay');
  wordDisplay.style.opacity = 0;
  setTimeout(() => {
    wordDisplay.textContent = "";
    wordDisplay.style.opacity = 1;
  }, 300);
}
</script>

</body>
</html>
