<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>å°æœ‹å‹é»˜ç”Ÿå­—</title>
<style>
  body { font-family: sans-serif; padding: 20px; text-align: center; background: #f0f8ff; }
  h1 { font-size: 28px; margin-bottom: 20px; }
  h2 { font-size: 18px; margin-bottom: 15px; }
  textarea { width: 100%; max-width: 400px; font-size: 18px; padding: 10px; border-radius: 10px; border: 1px solid #ccc; margin-bottom: 10px; height: 150px; }
  select { width: 100%; max-width: 400px; font-size: 16px; padding: 8px; border-radius: 10px; border: 1px solid #ccc; margin-bottom: 10px; }
  .small-button {
    display: inline-block;
    margin: 5px;
    padding: 8px 12px;
    font-size: 14px;
    border: none;
    border-radius: 10px;
    background: #4CAF50;
    color: white;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: background 0.2s, transform 0.1s;
    max-width: 120px;
  }
  .small-button:hover { background: #45a049; }
  .small-button:active { background: #3e8e41; transform: scale(0.95); }
  button.main-button {
    display: block;
    width: 90%;
    max-width: 300px;
    margin: 10px auto;
    padding: 15px;
    font-size: 20px;
    border: none;
    border-radius: 12px;
    background: #4CAF50;
    color: white;
    box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    transition: background 0.2s, transform 0.1s;
  }
  button.main-button:hover { background: #45a049; }
  button.main-button:active { background: #3e8e41; transform: scale(0.95); }
  #wordDisplay { font-size: 32px; margin-top: 20px; color: #333; min-height: 40px; transition: opacity 0.5s; }
  #counterDisplay { font-size: 20px; margin-top: 10px; color: #555; }
  .hidden { display: none; }
</style>
</head>
<body>

<!-- ç¬¬ä¸€ç‰ˆï¼šè¼¸å…¥ç”Ÿå­— -->
<div id="inputPage">
  <h1>é»˜ç”Ÿå­—å°ç¨‹å¼</h1>
  <h2>è¼¸å…¥ç”Ÿå­—ï¼ˆä»¥é€—è™Ÿåˆ†éš”ï¼‰</h2>
  <textarea id="wordInput" placeholder="ä¾‹å¦‚ï¼šè˜‹æœ,é¦™è•‰,æ©™å­"></textarea><br>
  <button class="main-button" onclick="confirmWords()">âœ… å¿ƒä¸­é–‹å§‹é»˜ç”Ÿå­—</button>
  <h2>ğŸ“š ç”Ÿå­—è¨˜éŒ„ç®¡ç†</h2>
  <select id="savedLists" onchange="loadSavedWords()">
    <option value="">é¸æ“‡å·²ä¿å­˜çš„æ¸…å–®</option>
  </select><br>
  <button class="small-button" onclick="saveCurrentWords()">ğŸ’¾ ä¿å­˜æ¸…å–®</button>
  <button class="small-button" onclick="renameSelectedList()">âœï¸ é‡æ–°å‘½å</button>
  <button class="small-button" onclick="deleteSelectedList()">ğŸ—‘ï¸ åˆªé™¤æ¸…å–®</button>
</div>

<!-- ç¬¬äºŒç‰ˆï¼šæ“ä½œç‰ˆ -->
<div id="gamePage" class="hidden">
  <h2>æŠ½ç”Ÿå­—æœ—è®€</h2>
  <div id="counterDisplay">å°šæœªé–‹å§‹</div>
  <div id="wordDisplay">(è«‹å…ˆæŠ½å‡ºä¸€å€‹ç”Ÿå­—)</div>
  <div>
    <button class="main-button" onclick="drawWord()">ğŸ² æŠ½å‡ºç”Ÿå­—ä¸¦æœ—è®€</button>
    <button class="main-button" onclick="showWord()">ğŸ‘ï¸â€ğŸ—¨ï¸ é¡¯ç¤ºå‰›æ‰ç”Ÿå­—</button>
    <button class="main-button" onclick="replayWord()">ğŸ”Š é‡è®€ä¸€æ¬¡</button>
    <button class="main-button" onclick="backToInput()">ğŸ”™ è¿”å›è¼¸å…¥é </button>
  </div>
</div>

<!-- å®Œæˆé é¢ -->
<div id="completePage" class="hidden">
  <h2>ğŸ‰ æ­å–œï¼ä½ å·²å®Œæˆå…¨éƒ¨ç”Ÿå­—é»˜æ›¸ï¼</h2>
  <button class="main-button" onclick="backToInput()">ğŸ”„ å†ä¾†ä¸€æ¬¡</button>
</div>

<script>
let words = [];
let activeWords = [];
let currentWord = "";
let voices = [];
let selectedVoice = null;
let counter = 0;

function initVoices() {
  voices = speechSynthesis.getVoices();
  selectedVoice = voices.find(voice => voice.lang.includes('zh-HK') || voice.name.includes('Cantonese')) ||
                  voices.find(voice => voice.lang.includes('zh-CN')) ||
                  voices.find(voice => voice.lang.includes('en-US'));
}

if (speechSynthesis.onvoiceschanged !== undefined) {
  speechSynthesis.onvoiceschanged = initVoices;
}

window.onload = function() {
  setTimeout(() => {
    initVoices();
    loadSavedListOptions();
  }, 500);
};

function confirmWords() {
  const input = document.getElementById('wordInput').value.trim();
  let wordList = input.split(',')
    .map(word => word.trim())
    .filter(word => word);

  const uniqueWords = [...new Set(wordList)];

  if (uniqueWords.length === 0) {
    alert('è«‹è‡³å°‘è¼¸å…¥ä¸€å€‹ç”Ÿå­—ï¼');
    return;
  }

  document.getElementById('wordInput').value = uniqueWords.join(',');
  words = [...uniqueWords];
  activeWords = [...uniqueWords];

  document.getElementById('inputPage').classList.add('hidden');
  document.getElementById('gamePage').classList.remove('hidden');
  counter = 0;
  updateCounterDisplay();
  document.getElementById('wordDisplay').textContent = "(è«‹å…ˆæŠ½å‡ºä¸€å€‹ç”Ÿå­—)";
}

function drawWord() {
  if (activeWords.length === 0) {
    alert('å…¨éƒ¨ç”Ÿå­—å·²ç¶“é»˜å®Œï¼');
    document.getElementById('gamePage').classList.add('hidden');
    document.getElementById('completePage').classList.remove('hidden');
    return;
  }
  counter++;
  updateCounterDisplay();
  const index = Math.floor(Math.random() * activeWords.length);
  currentWord = activeWords.splice(index, 1)[0];
  fadeOutInWordDisplay(currentWord);
  speak(currentWord);
}

function showWord() {
  if (!currentWord) {
    alert('è«‹å…ˆæŠ½å‡ºä¸€å€‹ç”Ÿå­—ï¼');
    return;
  }
  document.getElementById('wordDisplay').textContent = currentWord;
}

function replayWord() {
  if (!currentWord) {
    alert('è«‹å…ˆæŠ½å‡ºä¸€å€‹ç”Ÿå­—ï¼');
    return;
  }
  speak(currentWord);
}

function backToInput() {
  counter = 0;
  currentWord = "";
  document.getElementById('counterDisplay').textContent = "å°šæœªé–‹å§‹";
  document.getElementById('wordDisplay').textContent = "(è«‹å…ˆæŠ½å‡ºä¸€å€‹ç”Ÿå­—)";
  document.getElementById('gamePage').classList.add('hidden');
  document.getElementById('completePage').classList.add('hidden');
  document.getElementById('inputPage').classList.remove('hidden');
}

function updateCounterDisplay() {
  document.getElementById('counterDisplay').textContent = "å·²é»˜ç¬¬ " + counter + " å€‹ç”Ÿå­—";
}

function speak(text) {
  if (!text) return;
  const utterance = new SpeechSynthesisUtterance(text);
  if (!selectedVoice || voices.length === 0) {
    initVoices();
  }
  if (selectedVoice) {
    utterance.voice = selectedVoice;
  }
  utterance.rate = 0.9;
  speechSynthesis.speak(utterance);
}

function fadeOutInWordDisplay(word="") {
  const wordDisplay = document.getElementById('wordDisplay');
  wordDisplay.style.opacity = 0;
  setTimeout(() => {
    wordDisplay.textContent = "";
    setTimeout(() => {
      wordDisplay.textContent = word ? "" : "(è«‹å…ˆæŠ½å‡ºä¸€å€‹ç”Ÿå­—)";
      wordDisplay.style.opacity = 1;
    }, 100);
  }, 300);
}

function saveCurrentWords() {
  const input = document.getElementById('wordInput').value.trim();
  if (!input) {
    alert('è«‹å…ˆè¼¸å…¥ç”Ÿå­—å…§å®¹ï¼');
    return;
  }
  const name = prompt('è«‹è¼¸å…¥æ¸…å–®åç¨±ï¼ˆä¾‹å¦‚ï¼šè‹±æ–‡é»˜æ›¸ï¼‰ï¼š');
  if (name === null) {
    alert('å–æ¶ˆäº†ä¿å­˜ã€‚');
    return;
  }
  if (name.trim() === "") {
    alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„æ¸…å–®åç¨±ï¼');
    return;
  }
  localStorage.setItem('dictation-' + name.trim(), input);
  loadSavedListOptions();
  alert('å·²ä¿å­˜ç”Ÿå­—æ¸…å–®ï¼');
}

function loadSavedListOptions() {
  const select = document.getElementById('savedLists');
  select.innerHTML = '<option value="">é¸æ“‡å·²ä¿å­˜çš„æ¸…å–®</option>';
  // ç”¨ Object.keys(localStorage) ä¿è­‰éæ­·æ­£ç¢º
  Object.keys(localStorage).forEach(key => {
    if (key.startsWith('dictation-')) {
      const option = document.createElement('option');
      option.value = key;
      option.textContent = key.replace('dictation-', '');
      select.appendChild(option);
    }
  });
}

function loadSavedWords() {
  const select = document.getElementById('savedLists');
  const key = select.value;
  if (!key) return;
  const data = localStorage.getItem(key);
  document.getElementById('wordInput').value = data;
  alert('å·²è¼‰å…¥ç”Ÿå­—æ¸…å–®ï¼');
}

function deleteSelectedList() {
  const select = document.getElementById('savedLists');
  const key = select.value;
  if (!key) {
    alert('è«‹å…ˆé¸æ“‡ä¸€å€‹æ¸…å–®');
    return;
  }
  if (confirm('ç¢ºå®šè¦åˆªé™¤é€™å€‹ç”Ÿå­—æ¸…å–®ï¼Ÿ')) {
    localStorage.removeItem(key);
    loadSavedListOptions();
    alert('å·²åˆªé™¤æ¸…å–®ï¼');
  }
}

function renameSelectedList() {
  const select = document.getElementById('savedLists');
  const oldKey = select.value;
  if (!oldKey) {
    alert('è«‹å…ˆé¸æ“‡ä¸€å€‹æ¸…å–®');
    return;
  }
  const newName = prompt('è«‹è¼¸å…¥æ–°çš„æ¸…å–®åç¨±ï¼š');
  if (!newName) return;
  const data = localStorage.getItem(oldKey);
  localStorage.removeItem(oldKey);
  localStorage.setItem('dictation-' + newName.trim(), data);
  loadSavedListOptions();
  alert('å·²é‡æ–°å‘½åæ¸…å–®ï¼');
}
</script>

</body>
</html>
